{% extends '::base.html.twig' %}

{% block description %}This is an awesome web site.{% endblock %}

{% block stylesheets %}
{{parent()}}
<link href="{{ asset('jqvmap/jqvmap.css') }}" media="screen" rel="stylesheet" type="text/css" />
{% endblock %}

{% block body %}
<div class="container">
    <div class="row">
        <ul>
            <li><a href="{{path('db_main_homepage')}}">FPO</a></li>
            <li><a href="{{path('db_lens_homepage')}}">PatentLens</a></li>
        </ul>
    </div>
    <div class="row">
        <div class="col-md-5">
            <h2 class="well">Evolution du nombre de brevets publiés</h2>
            <div id="charts"></div>
        </div>
        <div class="col-md-7">
            <h2 class="well">Les top 10 inventeurs du monde.</h2>
            <div id="inventorsBar"></div>
        </div>
    </div>
    <div class="row">
        <h2 class="well">Les inventeurs répartis sur les pays.</h2>
        <div class="col-md-6" id="vmap" style="height: 400px;"></div>
        <div class="col-md-6" id="countrybars"><p>Cliquez sur un pays pour voir ses top 10 inventeurs.</p></div>
    </div>
    <div class="row">
        <h2 class="well">Les mots-clé les plus fréquents dans tous les brevets.</h2>
        <canvas height="600" width="1000" id="keywordsCloud"></canvas>
        <div id="keywordsPiechart"></div>
    </div>
</div>
{% endblock %}

{% set p = patent %}

{% block javascripts %}
{{parent()}}
<script src="{{ asset('highcharts/js/highcharts.js') }}"></script>
<script src="{{ asset('jqvmap/jquery.vmap.js') }}" type="text/javascript"></script>
<script src="{{ asset('jqvmap/maps/jquery.vmap.world.js') }}" type="text/javascript"></script>
<script src="{{ asset('js/vendor/wordcloud2.js') }}" type="text/javascript"></script>

<script type="text/javascript">
    $(document).ready(function() {
        $.ajax({
            type: 'GET',
            url: '{{path('db_' ~ p ~ '_inventors')}}?n=10',
            success: function(data) {
                showInventorsBar(data, '#inventorsBar');
            }
        });
        $.ajax({
            type: 'GET',
            url: '{{path('db_' ~ p ~ '_evolution')}}',
            success: function(data) {
                var graphData = new Array();
                var l = data.length;
                for (var i = 0; i < l; i++) {
                    graphData.push([Date.UTC(data[i].year, data[i].month - 1, data[i].day), data[i].count]);
                }
                showEvolution(graphData);
            }
        });
        $.ajax({
            type: 'GET',
            url: '{{path('db_' ~ p ~ '_inventors_country')}}',
            success: function(data) {
                createMap(data);
            }
        });
        $.ajax({
            type: 'GET',
            url: '{{path('db_' ~ p ~ '_keywords')}}',
            success: function(data) {
                var l = data.length;
                var d = new Array();
                for (var i = 0; i < l; i++) {
                    d.push([data[i].keyword, parseInt(data[i].count)]);
                }
                showKeywordsCloud(d);
            }
        });
        $.ajax({
            type: 'GET',
            url: '{{path('db_' ~ p ~ '_keywords')}}?n=10',
            success: function(data) {
                var l = data.length;
                var d = new Array();
                for (var i = 0; i < l; i++) {
                    d.push([data[i].keyword, data[i].count]);
                }
                showKeywordsPieChart(d);
            }
        });
        $.ajax({
            type: 'GET',
            url: '{{path('db_main_collab_inventors')}}',
            success: function(data) {
                console.log(data.length);
            }
        });
    });


    function inventors(element, code, region) {
        $.ajax({
            type: 'GET',
            url: '{{ path('db_' ~ p ~ '_inventors') }}?n=10&c=' + code,
            success: function(data) {
                if (data.error) {
                    alert(data.error);
                }
                showInventorsBar(data, '#countrybars');
            }
        });
    }
</script>
{% endblock %}
